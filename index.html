<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SQL Query Filler</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{
    background:#f4f6f9;
    font-family: system-ui, sans-serif;
}

.card{
    border-radius:10px;
    border:1px solid #ddd;
}

textarea{
    font-family: monospace;
    font-size:14px;
}

pre{
    font-family: monospace;
    font-size:14px;
    white-space: pre-wrap;
}

.copy-icon{
    cursor:pointer;
    color:#0d6efd;
    transition: all 0.2s ease;
}

.copy-icon.copied{
    color:#198754;
    transform: scale(1.25);
}

.copy-tooltip{
    font-size:11px;
    color:#198754;
    margin-left:6px;
}

.history-item{
    border:1px solid #ddd;
    border-radius:8px;
    padding:8px;
    margin-bottom:6px;
    background:#fff;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
</style>
</head>

<body>
<div class="container mt-3">

<!-- APP TITLE -->
<div class="text-center mb-3">
    <h3 class="fw-bold text-primary">
        <i class="bi bi-database"></i> SQL Query Filler
    </h3>
</div>

<!-- ROW 1 : HEADER + BUTTONS -->
<div class="card mb-3">
<div class="card-body p-2 d-flex flex-wrap align-items-center gap-2">

<strong class="me-2">Query Input</strong>

<button id="generateBtn" class="btn btn-primary btn-sm">
<i class="bi bi-play-fill"></i> Generate SQL
</button>

<button id="copyFinalBtn" class="btn btn-success btn-sm">
<i class="bi bi-clipboard"></i> Copy SQL
</button>

<button id="clearBtn" class="btn btn-outline-secondary btn-sm">
<i class="bi bi-x-circle"></i> Clear
</button>

<span id="paramCount" class="badge bg-secondary">0 Params</span>
<span id="placeholderCount" class="badge bg-secondary">0 Placeholders</span>

</div>
</div>

<!-- ROW 2 : QUERY + PARAMS -->
<div class="row g-2 mb-3">

<div class="col-md-8">
<div class="card">
<div class="card-body p-2">
<div class="d-flex justify-content-between align-items-center">
<strong>SQL Query</strong>
<i class="bi bi-clipboard copy-icon"
onclick="copyWithFeedback(this, document.getElementById('queryInput').value)">
</i>
</div>
<textarea id="queryInput" rows="6" class="form-control mt-1"
placeholder="SELECT * FROM users WHERE name = ? AND age = ?"></textarea>
</div>
</div>
</div>

<div class="col-md-4">
<div class="card">
<div class="card-body p-2">
<div class="d-flex justify-content-between align-items-center">
<strong>Parameters</strong>
<i class="bi bi-clipboard copy-icon"
onclick="copyWithFeedback(this, document.getElementById('paramsInput').value)">
</i>
</div>
<textarea id="paramsInput" rows="6" class="form-control mt-1"
placeholder="[John, 25]"></textarea>
</div>
</div>
</div>

</div>

<!-- ROW 3 : GENERATED SQL -->
<div class="card mb-3">
<div class="card-body p-2">
<div class="d-flex justify-content-between align-items-center">
<strong>Generated SQL</strong>
<i class="bi bi-clipboard copy-icon"
onclick="copyWithFeedback(this, document.getElementById('outputBox').textContent)">
</i>
</div>
<pre id="outputBox" class="mt-2 mb-0">Generated SQL will appear here...</pre>
</div>
</div>

<!-- ROW 4 : HISTORY -->
<div class="card">
<div class="card-body p-2">
<strong>History (Last 5)</strong>
<div id="historyBox" class="mt-2 text-muted small">No history yet</div>
</div>
</div>

<!-- FOOTER -->
<div class="text-center mt-3 small text-muted">
Developed by <strong>RRKumar</strong> | rrkumar@ibaset.com
</div>

</div>

<script>
const queryInput = document.getElementById("queryInput");
const paramsInput = document.getElementById("paramsInput");
const outputBox = document.getElementById("outputBox");
const paramCount = document.getElementById("paramCount");
const placeholderCount = document.getElementById("placeholderCount");
const historyBox = document.getElementById("historyBox");

let history = JSON.parse(localStorage.getItem("sqlHistory") || "[]");

/* COPY WITH LOOK & FEEL */
function copyWithFeedback(icon, text){
    navigator.clipboard.writeText(text).then(()=>{
        const original = icon.className;
        icon.className = "bi bi-check-circle-fill copy-icon copied";

        const tip = document.createElement("span");
        tip.className = "copy-tooltip";
        tip.innerText = "Copied!";
        icon.after(tip);

        setTimeout(()=>{
            icon.className = original;
            tip.remove();
        },1500);
    });
}

/* PARAM + PLACEHOLDER COUNT */
function updateCounts(){
    const pCount = extractParams().length;
    const qCount = (queryInput.value.match(/\?/g) || []).length;
    paramCount.textContent = pCount + " Params";
    placeholderCount.textContent = qCount + " Placeholders";
}

/* PARAM EXTRACTION */
function extractParams(){
    let v = paramsInput.value.trim();
    if(v.startsWith("[") && v.endsWith("]")){
        return v.slice(1,-1).split(",").map(e=>e.trim()).filter(e=>e);
    }
    return v ? [v] : [];
}

/* SQL GENERATE */
function generateSQL(){
    const query = queryInput.value;
    const params = extractParams();

    if((query.match(/\?/g)||[]).length !== params.length){
        outputBox.textContent = "Error: Parameters count mismatch";
        return;
    }

    let i=0;
    let result = query.replace(/\?/g,()=>{
        const p = params[i++];
        return isNaN(p) ? `'${p}'` : p;
    });

    outputBox.textContent = result;
    addHistory(result);
}

/* HISTORY */
function addHistory(sql){
    history.unshift(sql);
    history = history.slice(0,5);
    localStorage.setItem("sqlHistory", JSON.stringify(history));
    renderHistory();
}

function renderHistory(){
    if(history.length===0){
        historyBox.textContent="No history yet";
        return;
    }
    historyBox.innerHTML="";
    history.forEach((h,i)=>{
        historyBox.innerHTML += `
        <div class="history-item">
            <span class="text-truncate me-2">${h}</span>
            <div>
                <i class="bi bi-clipboard copy-icon me-2"
                onclick="copyWithFeedback(this, '${h.replace(/'/g,"\\'")}')"></i>
                <i class="bi bi-trash text-danger copy-icon"
                onclick="deleteHistory(${i})"></i>
            </div>
        </div>`;
    });
}

function deleteHistory(i){
    history.splice(i,1);
    localStorage.setItem("sqlHistory", JSON.stringify(history));
    renderHistory();
}

/* EVENTS */
document.getElementById("generateBtn").onclick = generateSQL;
document.getElementById("copyFinalBtn").onclick =
()=>copyWithFeedback(event.target, outputBox.textContent);

document.getElementById("clearBtn").onclick = ()=>{
    queryInput.value="";
    paramsInput.value="";
    outputBox.textContent="Generated SQL will appear here...";
    updateCounts();
};

queryInput.oninput = updateCounts;
paramsInput.oninput = updateCounts;

renderHistory();
updateCounts();
</script>

</body>
</html>
